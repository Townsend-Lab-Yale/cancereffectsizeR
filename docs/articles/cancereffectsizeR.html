<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cancereffectsizeR">
<title>Tutorial • cancereffectsizeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Tutorial">
<meta property="og:description" content="cancereffectsizeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cancereffectsizeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/cancereffectsizeR.html">Tutorial</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MAF_filtering_tips.html">MAF filtering and sample validation</a>
    <a class="dropdown-item" href="../articles/cosmic_cancer_type_note.html">Cancer type considerations for COSMIC signature extraction</a>
    <a class="dropdown-item" href="../articles/create_custom_covariates.html">Generate tissue covariates data</a>
    <a class="dropdown-item" href="../articles/custom_refset_instructions.html">Running with custom reference data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Townsend-Lab-Yale/cancereffectsizeR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Townsend-Lab-Yale/cancereffectsizeR/blob/main/vignettes/cancereffectsizeR.Rmd" class="external-link"><code>vignettes/cancereffectsizeR.Rmd</code></a></small>
      <div class="d-none name"><code>cancereffectsizeR.Rmd</code></div>
    </div>

    
    
<p>This tutorial applies some of the package’s key features to analyze
publicly-available somatic variant data from tumor sequencing. We
recommend that you start a fresh R/RStudio session. You can follow along
by copy-and-pasting code into an R script.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Start by installing the latest release:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Some dependencies are large, so we increase the download time limit to be safe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Townsend-Lab-Yale/cancereffectsizeR"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Regrettably, there is a bug in some older versions of the
GenomeInfoDb package that may produce cryptic error messages in
cancereffectsizeR, along the lines of
<code>!anyNA(m32) is not TRUE</code>. If you encounter this issue,
upgrade your Bioconductor version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only necessary if the current Bioconductor version is &lt;3.14.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/version.html" class="external-link">version</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html" class="external-link">as.package_version</a></span><span class="op">(</span><span class="st">"3.14"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html" class="external-link">install</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"3.14"</span><span class="op">)</span> <span class="co"># or newer, if desired</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In addition to installing cancereffectsizeR, you need to install a
reference data set, or <em>refset</em>. These refsets include genomic
and gene annotations, mutational signature definitions, and more.
Currently, refsets supporting the hg38 and hg19 builds of the human
genome are available as separate data packages. (If you want to build
your own refset to use a custom genome build or gene set for almost any
species, <a href="custom_refset_instructions.html">you can</a>.) For
this tutorial, we’ll use the hg38 refset package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"Townsend-Lab-Yale/ces.refset.hg38@*release"</span><span class="op">)</span></span></code></pre></div>
<p>Restart R/RStudio after installation. Before continuing, you may want
to create a directory for this tutorial to store all the data and output
in one place.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setwd() somewhere, if desired</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"CES_tutorial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"CES_tutorial"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quickstart">Quickstart<a class="anchor" aria-label="anchor" href="#quickstart"></a>
</h2>
<div class="section level3">
<h3 id="theoretical-overview">Theoretical overview<a class="anchor" aria-label="anchor" href="#theoretical-overview"></a>
</h3>
<p>Very briefly, we extract mutational signatures from each sample’s SNV
mutation profile using <a href="https://bioconductor.org/packages/release/bioc/html/MutationalPatterns.html" class="external-link">MutationalPatterns</a>.
The relative weights of biologically associated signatures are used to
infer trinucleotide-context-specific relative rates of SNV mutations for
each sample. Cohort-wide neutral gene mutation rates are calculated with
<a href="https://github.com/im3sanger/dndscv" class="external-link">dNdScv</a>, with
tissue-specific covariates provided by <code>ces.refset.hg38</code>.
Combining this information, the rate of neutral mutation at a particular
variant site is calculated by partitioning the gene mutation rate across
all sites in the gene in accordance with the signature-informed relative
rates. Comparing rates of observed and expected mutation under a model
of somatic selection allows an inference of selection intensity, which
we call cancer effect size.</p>
</div>
<div class="section level3">
<h3 id="example-lung-adenocarcinoma-data-from-tcga">Example: Lung adenocarcinoma data from TCGA<a class="anchor" aria-label="anchor" href="#example-lung-adenocarcinoma-data-from-tcga"></a>
</h3>
<p>If you want to skip all the details and run through a no-frills
cancereffectsizeR analysis now, see below. Otherwise, take a peek to get
a sense of what’s to come, or keep reading for a more thorough
walkthrough.</p>
<details><summary>
(Show/hide quickstart)
</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://townsend-lab-yale.github.io/cancereffectsizeR">cancereffectsizeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download TCGA lung adenocarcinoma (LUAD) somatic variant data.</span></span>
<span><span class="va">tcga_maf_file</span> <span class="op">&lt;-</span> <span class="st">"TCGA-LUAD.maf.gz"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">tcga_maf_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_TCGA_project_MAF.html">get_TCGA_project_MAF</a></span><span class="op">(</span>project <span class="op">=</span> <span class="st">"LUAD"</span>, filename <span class="op">=</span> <span class="st">"TCGA-LUAD.maf.gz"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Prepare data</span></span>
<span><span class="va">maf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preload_maf.html">preload_maf</a></span><span class="op">(</span>maf <span class="op">=</span> <span class="va">tcga_maf_file</span>, refset <span class="op">=</span> <span class="st">"ces.refset.hg38"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create cancereffectsizeR analysis and load data</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CESAnalysis.html">CESAnalysis</a></span><span class="op">(</span>refset <span class="op">=</span> <span class="st">"ces.refset.hg38"</span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_maf.html">load_maf</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, maf <span class="op">=</span> <span class="va">maf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Infer trinculeotide-context-specific relative rates of SNV mutation from</span></span>
<span><span class="co"># a mutational signature analysis (leaving out signatures not found in LUAD)</span></span>
<span><span class="va">signature_exclusions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suggest_cosmic_signature_exclusions.html">suggest_cosmic_signature_exclusions</a></span><span class="op">(</span>cancer_type <span class="op">=</span> <span class="st">"LUAD"</span>, treatment_naive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trinuc_mutation_rates.html">trinuc_mutation_rates</a></span><span class="op">(</span></span>
<span>  cesa <span class="op">=</span> <span class="va">cesa</span>, signature_set <span class="op">=</span> <span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">signatures</span><span class="op">$</span><span class="va">COSMIC_v3.2</span>,</span>
<span>  signature_exclusions <span class="op">=</span> <span class="va">signature_exclusions</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate neutral gene mutation rates using dNdScv, with tissue-specific mutation rate covariates.</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gene_mutation_rates.html">gene_mutation_rates</a></span><span class="op">(</span><span class="va">cesa</span>, covariates <span class="op">=</span> <span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">covariates</span><span class="op">$</span><span class="va">lung</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Infer scaled selection coefficients under the default model of clonal selection.</span></span>
<span><span class="co"># By default, inference is restricted to recurrent mutations.</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ces_variant.html">ces_variant</a></span><span class="op">(</span><span class="va">cesa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Take top 15 variants, then sort lowest to highest (to plot left to right)</span></span>
<span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">selection</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="va">selection</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">selection_intensity</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="va">top</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">selection_intensity</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot top effects</span></span>
<span><span class="va">top</span><span class="op">[</span>, <span class="va">display_name</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">"\n"</span>, <span class="va">variant_name</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">top</span><span class="op">[</span>, <span class="va">display_levels</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">display_name</span>, levels <span class="op">=</span> <span class="va">display_name</span>, ordered <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="st">"Top cancer effects in TCGA LUAD"</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">top</span><span class="op">$</span><span class="va">included_with_variant</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">top</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">display_levels</span>, y <span class="op">=</span> <span class="va">selection_intensity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_low_95</span>, ymax <span class="op">=</span> <span class="va">ci_high_95</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">.2</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">included_with_variant</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span>, big.mark <span class="op">=</span> <span class="st">","</span>, scientific <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"variant prevalence"</span>, guide <span class="op">=</span> <span class="st">"colorbar"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>,</span>
<span>    option <span class="op">=</span> <span class="st">"plasma"</span>, breaks <span class="op">=</span> <span class="va">breaks</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"cancer effect"</span> <span class="op">~</span> <span class="fu">scriptstyle</span><span class="op">(</span><span class="op">~</span> <span class="op">~</span> <span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">plot_title</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>ticks <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Verdana"</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># There's lots more that can be done with cancereffectsizeR! See the full tutorial for some</span></span>
<span><span class="co"># useful details and a broader view of functionality.</span></span></code></pre></div>
<p><img src="cancereffectsizeR_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</details>
</div>
</div>
<div class="section level2">
<h2 id="preparing-data">Preparing data<a class="anchor" aria-label="anchor" href="#preparing-data"></a>
</h2>
<p>Load cancereffectsizeR, as well as the data.table package.
cancereffectsizeR makes extensive use of data tables, so it’s handy to
have the package loaded.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://townsend-lab-yale.github.io/cancereffectsizeR">cancereffectsizeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p>For this tutorial, we’ll use somatic variant data produced from exome
sequencing by the TCGA BRCA (breast carcinoma) project. We will
supplement the WXS data with targeted sequencing data from the
Metastatic Breast Cancer data set <a href="https://www.cbioportal.org/study/summary?id=breast_ink4_msk_2021" class="external-link">hosted
at cBioPortal</a>.</p>
<p>In cancereffectsizeR, data can be combined from multiple whole-exome,
whole-genome, and targeted sequencing sources, although we always need
at least one WXS or WGS source to anchor the analysis. Targeted
sequencing data can’t be used for mutation rate inference: there are too
few mutations, typically, and since they’re mostly in cancer hotspots,
they don’t provide a baseline of what mutation rates are like in the
absence of selection. Instead, mutation rates in TGS samples will be
assumed to be similar to those calculated in WXS/WGS samples.</p>
<div class="section level3">
<h3 id="tcga-data-whole-exome">TCGA data (whole-exome)<a class="anchor" aria-label="anchor" href="#tcga-data-whole-exome"></a>
</h3>
<p>We’ll begin by downloading variant data from TCGA. The function
downloads patient MAF data from the latest TCGA data release and
assembles a project-level MAF.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tcga_maf_file</span> <span class="op">&lt;-</span> <span class="st">"TCGA-BRCA.maf.gz"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">tcga_maf_file</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/get_TCGA_project_MAF.html">get_TCGA_project_MAF</a></span><span class="op">(</span>project <span class="op">=</span> <span class="st">"BRCA"</span>, filename <span class="op">=</span> <span class="va">tcga_maf_file</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Let’s also load and examine a table of patient information. Although
the TCGA samples in the data set are all taken from primary tumors,
you’ll see that some patients presented with metastatic disease (pM =
M1). Hormone receptor status (progesterone or estrogen receptor
positive) and HER2 amplification status are also recorded in a combined
column.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tcga_clinical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"tutorial/TCGA_BRCA_clinical.txt"</span>, package <span class="op">=</span> <span class="st">"cancereffectsizeR"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change patient identifier column name in clinical table to match the MAF.</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">tcga_clinical</span>, <span class="st">"patient_id"</span>, <span class="st">"Unique_Patient_Identifier"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Peek at data</span></span>
<span><span class="va">tcga_clinical</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    Unique_Patient_Identifier   pM receptor_status</span></span>
<span><span class="co">## 1:              TCGA-3C-AAAU &lt;NA&gt;       HR+/HER2-</span></span>
<span><span class="co">## 2:              TCGA-3C-AALI   M0       HR+/HER2+</span></span>
<span><span class="co">## 3:              TCGA-3C-AALJ   M0            &lt;NA&gt;</span></span>
<span><span class="co">## 4:              TCGA-3C-AALK   M0       HR+/HER2+</span></span>
<span><span class="co">## 5:              TCGA-4H-AAAK   M0            &lt;NA&gt;</span></span></code></pre>
<p>The <code><a href="../reference/preload_maf.html">preload_maf()</a></code> function takes in MAF data, extracts
the columns needed by cancereffectsizeR, adds a couple of genomic
annotations, and checks for common problems. (For your own analyses, see
our <a href="MAF_filtering_tips.html">MAF data tips</a>.) This MAF file
already uses the hg38 genome build, but if it didn’t, we could use the
<code>chain_file</code> argument to convert records via liftOver.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tcga_maf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preload_maf.html">preload_maf</a></span><span class="op">(</span>maf <span class="op">=</span> <span class="va">tcga_maf_file</span>, refset <span class="op">=</span> <span class="st">"ces.refset.hg38"</span><span class="op">)</span></span></code></pre></div>
<p>When MAFs created by are fed into , TCGA sample replicates are
effectively merged, since the Unique_Patient_Identifier column
supersedes Tumor_Sample_Barcode (the original sample identifiers). You
will see a note that preload_maf() caught and handled the ensuing
duplicate mutation records.</p>
</div>
<div class="section level3">
<h3 id="metastatic-data-tgs">Metastatic data (TGS)<a class="anchor" aria-label="anchor" href="#metastatic-data-tgs"></a>
</h3>
<p>Our TGS data source (hosted on cBioPortal and <a href="https://cancerdiscovery.aacrjournals.org/content/candisc/early/2021/09/17/2159-8290.CD-20-1726.full.pdf" class="external-link">recently
published</a> in Cancer Discovery), consists of metastatic tumors that
were sequenced using various MSK-Impact panels. In the full data set,
some patients have multiple samples sequenced; the data provided with
the package has been subsetted to one sample per patient, and the genome
build has been converted to hg38.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tgs_maf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"tutorial/metastatic_breast_2021_hg38.maf"</span>, package <span class="op">=</span> <span class="st">"cancereffectsizeR"</span><span class="op">)</span></span>
<span><span class="va">tgs_maf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preload_maf.html">preload_maf</a></span><span class="op">(</span>maf <span class="op">=</span> <span class="va">tgs_maf_file</span>, refset <span class="op">=</span> <span class="st">"ces.refset.hg38"</span><span class="op">)</span></span></code></pre></div>
<p>When combining data from multiple sources,
<code><a href="../reference/check_sample_overlap.html">check_sample_overlap()</a></code> can detect unexpected sample
duplication. If you feed in <code>tcga_maf</code> and
<code>tgs_maf</code> and filter the output to
<code>variants_shared &gt; 2</code> (with panel data, a couple of shared
variants doesn’t imply sample duplication), you’ll see that everything
looks fine.</p>
</div>
</div>
<div class="section level2">
<h2 id="create-cesanalysis-and-load-data">Create CESAnalysis and load data<a class="anchor" aria-label="anchor" href="#create-cesanalysis-and-load-data"></a>
</h2>
<p>The CESAnalysis is the primary data structure of cancereffectsizeR.
The cancereffectsizeR workflow consists of calling a series of functions
that take a CESAnalysis as input and return an altered CESAnalysis.</p>
<div class="section level3">
<h3 id="load-whole-exome-sequencing-data">Load whole-exome sequencing data<a class="anchor" aria-label="anchor" href="#load-whole-exome-sequencing-data"></a>
</h3>
<p>Let’s create a CESAnalysis and call <code><a href="../reference/load_maf.html">load_maf()</a></code> to load
the TCGA data. Since we’re going to load more than one MAF, we’ll
provide an optional <code>maf_name</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CESAnalysis.html">CESAnalysis</a></span><span class="op">(</span>refset <span class="op">=</span> <span class="st">"ces.refset.hg38"</span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_maf.html">load_maf</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, maf <span class="op">=</span> <span class="va">tcga_maf</span>, maf_name <span class="op">=</span> <span class="st">"BRCA"</span><span class="op">)</span></span></code></pre></div>
<p>You will see a message that some variants fall outside of the
refset’s exome definitions. Since we don’t know exactly what exome
capture techniques were used for the BRCA project (probably different
methods at different study sites), this isn’t unexpected. (On the off
chance that you do know the exact exome capture intervals of whatever
data you’re using, you should supply those intervals with
<code><a href="../reference/load_maf.html">load_maf()</a></code>’s <code>covered_regions</code> argument. For WGS
data, simply set <code>coverage = "genome"</code>.)</p>
<p>To navigate a CESAnalysis, use the dollar sign ($). We can use these
accessors to look at the MAF data as well more detailed variant
annotations, and if we want we can perform various filtering operations,
such as identifying the most prevalent variants in the loaded data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cesa</span><span class="op">$</span><span class="va">maf</span></span>
<span><span class="va">cesa</span><span class="op">$</span><span class="va">variants</span></span>
<span><span class="va">cesa</span><span class="op">$</span><span class="va">samples</span></span>
<span></span>
<span><span class="co"># Let's see the top variants</span></span>
<span><span class="op">(</span><span class="va">top_variants</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">maf_prevalence</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu">.</span><span class="op">(</span><span class="va">variant_name</span>, <span class="va">chr</span>, <span class="va">start</span>, <span class="va">end</span>, <span class="va">maf_prevalence</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Let’s load the clinical data into the analysis, too.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sample_data.html">load_sample_data</a></span><span class="op">(</span><span class="va">cesa</span>, <span class="va">tcga_clinical</span><span class="op">)</span></span></code></pre></div>
<p>Now that we’ve loaded the sample data, we can, for example, see how
variant counts break down across different sample groups. Let’s see a
breakdown PIK3CA mutation status by BRCA receptor phenotype.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get samples with 1 or more PIK3CA mutation</span></span>
<span><span class="va">samples_with_pik3ca</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">maf</span><span class="op">[</span><span class="va">top_gene</span> <span class="op">==</span> <span class="st">"PIK3CA"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Unique_Patient_Identifier</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pik3ca_sample_counts</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="va">samples_with_pik3ca</span>, <span class="fu">.</span><span class="op">(</span>with_PIK3CA <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"receptor_status"</span>, on <span class="op">=</span> <span class="st">"Unique_Patient_Identifier"</span></span>
<span><span class="op">]</span></span>
<span><span class="va">total_sample_counts</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="st">"receptor_status"</span><span class="op">]</span></span>
<span><span class="va">combined_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge.data.table</a></span><span class="op">(</span><span class="va">pik3ca_sample_counts</span>, <span class="va">total_sample_counts</span>, by <span class="op">=</span> <span class="st">"receptor_status"</span><span class="op">)</span></span>
<span><span class="va">combined_counts</span><span class="op">[</span>, <span class="va">freq</span> <span class="op">:=</span> <span class="va">with_PIK3CA</span> <span class="op">/</span> <span class="va">N</span><span class="op">]</span></span>
<span><span class="va">combined_counts</span></span></code></pre></div>
<p>PIK3CA mutation is least prevalent in triple negative breast
cancer.</p>
</div>
<div class="section level3">
<h3 id="load-targeted-gene-sequencing-data">Load targeted gene sequencing data<a class="anchor" aria-label="anchor" href="#load-targeted-gene-sequencing-data"></a>
</h3>
<p>To load our TGS data, we need to be able to define its coverage. Why?
To estimate the selection of a mutation, we need to know which samples
have the mutation, which samples do not, and which are unknown due to
lack of sequencing coverage. Our TGS samples were sequenced with
multiple panels covering different genes, and unfortunately, the exact
coverage (defined by genomic coordinates) is not publicly available for
all of these. Therefore, for simplicity, we will filter the TGS data to
mutations at a handful of top cancer genes that are covered in all of
the panels. When we load the data, all records outside of these genes
will be excluded, leaving us with greater power to infer selection in
these genes without impacting our estimates outside these genes, which
will use just the TCGA data. (As mentioned earlier, we shouldn’t filter
WXS/WGS data this way, since it would interfere with mutation rate
calculation, but TGS samples are not involved in mutation rate
calculation.)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define coverage using the coding regions of these genes, as defined by the refset</span></span>
<span><span class="va">top_tgs_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"TP53"</span>, <span class="st">"PIK3CA"</span>, <span class="st">"ESR1"</span>, <span class="st">"CDH1"</span>, <span class="st">"GATA3"</span>, <span class="st">"KMT2C"</span>,</span>
<span>  <span class="st">"MAP3K1"</span>, <span class="st">"AKT1"</span>, <span class="st">"ARID1A"</span>, <span class="st">"FOXA1"</span>, <span class="st">"TBX3"</span>, <span class="st">"PTEN"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tgs_coverage</span> <span class="op">&lt;-</span> <span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">gr_genes</span><span class="op">[</span><span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">gr_genes</span><span class="op">$</span><span class="va">gene</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top_tgs_genes</span><span class="op">]</span></span></code></pre></div>
<p>We don’t have a clinical file for the TGS data, but we do know that
they’re all metastatic samples. Instead of creating another table and
calling <code><a href="../reference/load_sample_data.html">load_sample_data()</a></code>, we can use the
<code>sample_data_cols</code> argument in load_maf(). We will also add a
little bit of padding (10 bp) to our coverage definitions to allow
variants just outside coding regions to be considered covered.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tgs_maf</span><span class="op">$</span><span class="va">pM</span> <span class="op">&lt;-</span> <span class="st">"M1"</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_maf.html">load_maf</a></span><span class="op">(</span><span class="va">cesa</span>,</span>
<span>  maf <span class="op">=</span> <span class="va">tgs_maf</span>, sample_data_cols <span class="op">=</span> <span class="st">"pM"</span>, maf_name <span class="op">=</span> <span class="st">"MBC"</span>,</span>
<span>  coverage <span class="op">=</span> <span class="st">"targeted"</span>, covered_regions <span class="op">=</span> <span class="va">tgs_coverage</span>,</span>
<span>  covered_regions_name <span class="op">=</span> <span class="st">"top_genes"</span>, covered_regions_padding <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now that all the data is loaded, we’ll show one data-wrangling
example: Let’s look at variant prevalence by metastatic disease status.
By default, the <code><a href="../reference/variant_counts.html">variant_counts()</a></code> function considers all
mutations, but we’ll subset to recurrent mutations.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_by_M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variant_counts.html">variant_counts</a></span><span class="op">(</span></span>
<span>  cesa <span class="op">=</span> <span class="va">cesa</span>, variant_ids <span class="op">=</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="va">maf_prevalence</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="va">variant_id</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"pM"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">counts_by_M</span><span class="op">[</span><span class="va">M1_prevalence</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">M1_prevalence</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mutational-processes-and-relative-mutation-rates">Mutational processes and relative mutation rates<a class="anchor" aria-label="anchor" href="#mutational-processes-and-relative-mutation-rates"></a>
</h2>
<p>For each (exome) sample in our data set,
<code><a href="../reference/trinuc_mutation_rates.html">trinuc_mutation_rates()</a></code> will perform mutational signature
extraction in order to to attribute each sample’s set of SNVs to a
linear combination of mutational processes. By default, the signature
extraction is done using the <code>MutationalPatterns</code> package,
and <code>deconstructSigs</code> is also supported. The signature
attribution allows us to infer sample-specific relative rates of SNV
mutation for all trinucleotide contexts. TGS samples will be assumed to
have mutational processes matching the group-average mutational
processes of the exome data. (This isn’t optimal, since the metastatic
samples may be affected by mutational processes, such as chemotherapy,
that are lacking in the primary tumor exome data, but it might be the
best we can do without finding another data source.)</p>
<p>We will use signature definitions from the refset (it’s also possible
to create your own). To improve the accuracy of signature extraction, we
will exclude signatures that can safely be presumed absent from the
samples; a helper function,
<code><a href="../reference/suggest_cosmic_signature_exclusions.html">suggest_cosmic_signature_exclusions()</a></code>, can provide some
guidance.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We'll use all suggested exclusions (TCGA primary tumors are treatment-naive)</span></span>
<span><span class="va">signature_exclusions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suggest_cosmic_signature_exclusions.html">suggest_cosmic_signature_exclusions</a></span><span class="op">(</span>cancer_type <span class="op">=</span> <span class="st">"BRCA"</span>, treatment_naive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trinuc_mutation_rates.html">trinuc_mutation_rates</a></span><span class="op">(</span><span class="va">cesa</span>,</span>
<span>  signature_set <span class="op">=</span> <span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">signatures</span><span class="op">$</span><span class="va">COSMIC_v3.2</span>,</span>
<span>  signature_exclusions <span class="op">=</span> <span class="va">signature_exclusions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/trinuc_mutation_rates.html">trinuc_mutation_rates()</a></code> run has added some useful
information to the CESAnalysis:</p>
<ul>
<li>
<strong>snv_counts</strong>: A matrix of SNV counts by trinucleotide
context. (You can also generate such a matrix from MAF data with
<code><a href="../reference/trinuc_snv_counts.html">trinuc_snv_counts()</a></code>.)</li>
<li>
<strong>raw_attributions</strong>: Signature attributions as
generated by the extractor. For MutationalPatterns, this matrix contains
the number of mutations attributed to signature for each sample.
Naturally, samples with more mutations will tend to have higher raw
attributions.</li>
<li>
<strong>biological_weights</strong>: The proportion of mutations
attributed to each biologically-associated signature within each sample.
Mutations attributed to signatures associated with sequencing/processing
artifacts are left out. (Technical detail: Due to the instability of
signature attributions on samples with few mutations, Samples with few
MAF variants have their weights adjusted towards group-average weights,
as indicated in the <code>group_avg_blended</code> column. If you want
to make claims about subgroup differences in mutational processes,
consider leaving these samples out or using the raw attributions. You
should also leave out the TGS samples, which in this analysis are
treated as having 0 mutations.)</li>
<li>
<strong>trinuc_rates</strong>: Inferred relative rates of mutation,
produced by matrix-multiplying biological_weights and signature
definitions. (These rates will not equal empirical rates of observed
mutations.)</li>
</ul>
<p>While we’re here, MutationalPatterns has some nice plot functions
that we can use. For example, we can plot the mean SNV profile for each
BRCA receptor subtype. (We would want to exclude TGS samples in this
plot because cancer hotspot mutations are not reflective of overall
mutational processes, but our TGS samples lack receptor_status
information, so they will already be left out without having to
specifically exclude them.)</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">snv_counts</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">mutational_signatures</span><span class="op">$</span><span class="va">snv_counts</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Counts look like this:</span></span>
<span><span class="va">snv_counts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCGA-A2-A1FW"</span>, <span class="st">"TCGA-C8-A1HL"</span>, <span class="st">"TCGA-EW-A1P5"</span>, <span class="st">"TCGA-C8-A1HM"</span>, <span class="st">"TCGA-AN-A0FN"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##           </span></span>
<span><span class="co">## trinuc_snv TCGA-A2-A1FW TCGA-C8-A1HL TCGA-EW-A1P5 TCGA-C8-A1HM TCGA-AN-A0FN</span></span>
<span><span class="co">##    A[C&gt;A]A            0            0            0            2            0</span></span>
<span><span class="co">##    A[C&gt;A]C            0            1            0            2            1</span></span>
<span><span class="co">##    A[C&gt;A]G            1            0            0            1            1</span></span>
<span><span class="co">##    A[C&gt;A]T            1            0            0            0            0</span></span>
<span><span class="co">##    C[C&gt;A]A            0            0            0            0            1</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We'll sum up the counts by group, leaving out a sample that has no SNVs.</span></span>
<span><span class="va">summed_snv_by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">receptor_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">cesa</span><span class="op">$</span><span class="va">samples</span><span class="op">$</span><span class="va">receptor_status</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">samples_with_snvs</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">snv_counts</span><span class="op">)</span>, on <span class="op">=</span> <span class="st">"Unique_Patient_Identifier"</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">grp</span> <span class="kw">in</span> <span class="va">receptor_groups</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">curr_samples</span> <span class="op">&lt;-</span> <span class="va">samples_with_snvs</span><span class="op">[</span><span class="va">grp</span>, <span class="va">Unique_Patient_Identifier</span>, on <span class="op">=</span> <span class="st">"receptor_status"</span><span class="op">]</span></span>
<span>  <span class="va">curr_snv_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">snv_counts</span><span class="op">[</span>, <span class="va">curr_samples</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">summed_snv_by_group</span><span class="op">[</span>, <span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op">:=</span> <span class="va">curr_snv_sum</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">summed_snv_by_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">summed_snv_by_group</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">summed_snv_by_group</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">snv_counts</span><span class="op">)</span></span>
<span><span class="fu">MutationalPatterns</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MutationalPatterns/man/plot_96_profile.html" class="external-link">plot_96_profile</a></span><span class="op">(</span><span class="va">summed_snv_by_group</span><span class="op">)</span></span></code></pre></div>
<p><img src="cancereffectsizeR_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="gene-mutation-rates">Gene mutation rates<a class="anchor" aria-label="anchor" href="#gene-mutation-rates"></a>
</h2>
<p>Next, we’ll use <code><a href="../reference/gene_mutation_rates.html">gene_mutation_rates()</a></code> to estimate
regional rates of mutation in the absence of selection. We’ll use the
method provided in the dNdScv package, which uses dN/dS ratios and
mutation rate covariates. Our refset has pre-computed covariates for a
variety of tissue types. As with mutational processes, this analysis
will not use the TGS samples, but the calculated rates will be assumed
to hold for them.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gene_mutation_rates.html">gene_mutation_rates</a></span><span class="op">(</span><span class="va">cesa</span>, covariates <span class="op">=</span> <span class="va">ces.refset.hg38</span><span class="op">$</span><span class="va">covariates</span><span class="op">$</span><span class="va">breast</span><span class="op">)</span></span></code></pre></div>
<p>Here are the neutral gene mutation rates extracted from dNdScv’s
regression:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cesa</span><span class="op">$</span><span class="va">gene_rates</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  pid    gene         rate rate_grp_1_95_low rate_grp_1_95_high</span></span>
<span><span class="co">## 1: ENSP00000000233.5    ARF5 6.350206e-07      5.947954e-07       6.778247e-07</span></span>
<span><span class="co">## 2: ENSP00000000412.3    M6PR 5.756903e-07      5.446158e-07       6.084135e-07</span></span>
<span><span class="co">## 3: ENSP00000000442.6   ESRRA 5.382191e-07      5.018193e-07       5.769928e-07</span></span>
<span><span class="co">## 4: ENSP00000001008.4   FKBP4 8.303021e-07      7.736213e-07       8.906310e-07</span></span>
<span><span class="co">## 5: ENSP00000001146.2 CYP26B1 9.182355e-07      8.796483e-07       9.581680e-07</span></span>
<span><span class="co">## 6: ENSP00000002125.4 NDUFAF7 5.969951e-07      5.716527e-07       6.233497e-07</span></span></code></pre>
<p>We can also look at dNdScv’s identification of selection at the gene
level. We’ll filter results to q &lt; .05. Since ces.refset.hg38 covers
multiple isoforms for some genes, the dNdScv output is actually per
protein, not per gene, so we’ll take the extra step of showing just the
lowest q-value for each significant gene.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dndscv_results</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">dNdScv_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">sig_genes</span> <span class="op">&lt;-</span> <span class="va">dndscv_results</span><span class="op">[</span><span class="va">qallsubs_cv</span> <span class="op">&lt;</span> <span class="fl">.05</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Take lowest q-value record for each gene, and sort by significance.</span></span>
<span><span class="va">sig_genes</span> <span class="op">&lt;-</span> <span class="va">sig_genes</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">qallsubs_cv</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"gene"</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">qallsubs_cv</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table table table-condensed">
<thead><tr>
<th style="text-align:right;">
gene
</th>
<th style="text-align:right;">
pid
</th>
<th style="text-align:right;">
n_syn
</th>
<th style="text-align:right;">
n_mis
</th>
<th style="text-align:right;">
n_non
</th>
<th style="text-align:right;">
n_spl
</th>
<th style="text-align:right;">
wmis_cv
</th>
<th style="text-align:right;">
wnon_cv
</th>
<th style="text-align:right;">
wspl_cv
</th>
<th style="text-align:right;">
pmis_cv
</th>
<th style="text-align:right;">
ptrunc_cv
</th>
<th style="text-align:right;">
pallsubs_cv
</th>
<th style="text-align:right;">
qmis_cv
</th>
<th style="text-align:right;">
qtrunc_cv
</th>
<th style="text-align:right;">
qallsubs_cv
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
TP53
</td>
<td style="text-align:right;">
ENSP00000484409.1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
181
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
284.9773016
</td>
<td style="text-align:right;">
646.271538
</td>
<td style="text-align:right;">
646.271538
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:right;">
PIK3CA
</td>
<td style="text-align:right;">
ENSP00000263967.3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
336
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
51.7950168
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
1.802329e-01
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
8.421570e-01
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:right;">
PTEN
</td>
<td style="text-align:right;">
ENSP00000361021.3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11.6145134
</td>
<td style="text-align:right;">
92.491633
</td>
<td style="text-align:right;">
92.491633
</td>
<td style="text-align:right;">
1.740561e-07
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
2.712921e-04
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:right;">
CDH1
</td>
<td style="text-align:right;">
ENSP00000261769.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
4.4888974
</td>
<td style="text-align:right;">
142.197772
</td>
<td style="text-align:right;">
142.197772
</td>
<td style="text-align:right;">
3.108585e-04
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
2.657038e-01
</td>
<td style="text-align:right;">
0.000000e+00
</td>
<td style="text-align:right;">
0.000000e+00
</td>
</tr>
<tr>
<td style="text-align:right;">
MAP2K4
</td>
<td style="text-align:right;">
ENSP00000262445.5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
10.4813306
</td>
<td style="text-align:right;">
77.490771
</td>
<td style="text-align:right;">
77.490771
</td>
<td style="text-align:right;">
1.663177e-06
</td>
<td style="text-align:right;">
1.332268e-15
</td>
<td style="text-align:right;">
1.110223e-16
</td>
<td style="text-align:right;">
2.319432e-03
</td>
<td style="text-align:right;">
2.941758e-12
</td>
<td style="text-align:right;">
2.451465e-13
</td>
</tr>
<tr>
<td style="text-align:right;">
KMT2C
</td>
<td style="text-align:right;">
ENSP00000262189.6
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.4978583
</td>
<td style="text-align:right;">
14.327120
</td>
<td style="text-align:right;">
14.327120
</td>
<td style="text-align:right;">
2.676400e-01
</td>
<td style="text-align:right;">
2.553513e-15
</td>
<td style="text-align:right;">
2.220446e-16
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
5.204649e-12
</td>
<td style="text-align:right;">
4.525781e-13
</td>
</tr>
<tr>
<td style="text-align:right;">
MAP3K1
</td>
<td style="text-align:right;">
ENSP00000382423.3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.9762851
</td>
<td style="text-align:right;">
24.418959
</td>
<td style="text-align:right;">
24.418959
</td>
<td style="text-align:right;">
2.751383e-03
</td>
<td style="text-align:right;">
1.221245e-15
</td>
<td style="text-align:right;">
1.176836e-14
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
2.941758e-12
</td>
<td style="text-align:right;">
2.227331e-11
</td>
</tr>
<tr>
<td style="text-align:right;">
AKT1
</td>
<td style="text-align:right;">
ENSP00000270202.4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
17.1487122
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
1.171285e-13
</td>
<td style="text-align:right;">
5.747608e-01
</td>
<td style="text-align:right;">
5.659917e-13
</td>
<td style="text-align:right;">
2.387350e-10
</td>
<td style="text-align:right;">
8.421570e-01
</td>
<td style="text-align:right;">
7.893201e-10
</td>
</tr>
<tr>
<td style="text-align:right;">
ARID1A
</td>
<td style="text-align:right;">
ENSP00000320485.7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.9984363
</td>
<td style="text-align:right;">
27.510255
</td>
<td style="text-align:right;">
27.510255
</td>
<td style="text-align:right;">
1.371621e-01
</td>
<td style="text-align:right;">
4.649614e-13
</td>
<td style="text-align:right;">
2.422507e-12
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
8.800059e-10
</td>
<td style="text-align:right;">
3.209458e-09
</td>
</tr>
<tr>
<td style="text-align:right;">
NCOR1
</td>
<td style="text-align:right;">
ENSP00000268712.2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.6313224
</td>
<td style="text-align:right;">
18.506772
</td>
<td style="text-align:right;">
18.506772
</td>
<td style="text-align:right;">
1.900419e-02
</td>
<td style="text-align:right;">
4.472978e-12
</td>
<td style="text-align:right;">
3.332179e-11
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
7.901366e-09
</td>
<td style="text-align:right;">
4.204416e-08
</td>
</tr>
<tr>
<td style="text-align:right;">
CBFB
</td>
<td style="text-align:right;">
ENSP00000290858.6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.8506034
</td>
<td style="text-align:right;">
43.563153
</td>
<td style="text-align:right;">
43.563153
</td>
<td style="text-align:right;">
4.201062e-08
</td>
<td style="text-align:right;">
6.284128e-07
</td>
<td style="text-align:right;">
5.370426e-11
</td>
<td style="text-align:right;">
7.421036e-05
</td>
<td style="text-align:right;">
8.763712e-04
</td>
<td style="text-align:right;">
6.468190e-08
</td>
</tr>
<tr>
<td style="text-align:right;">
FOXA1
</td>
<td style="text-align:right;">
ENSP00000250448.3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13.9476112
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
6.210821e-11
</td>
<td style="text-align:right;">
7.261135e-01
</td>
<td style="text-align:right;">
4.146918e-10
</td>
<td style="text-align:right;">
1.175487e-07
</td>
<td style="text-align:right;">
8.421570e-01
</td>
<td style="text-align:right;">
4.395236e-07
</td>
</tr>
<tr>
<td style="text-align:right;">
RUNX1
</td>
<td style="text-align:right;">
ENSP00000351123.5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.0460282
</td>
<td style="text-align:right;">
36.286848
</td>
<td style="text-align:right;">
36.286848
</td>
<td style="text-align:right;">
8.879471e-07
</td>
<td style="text-align:right;">
1.404351e-04
</td>
<td style="text-align:right;">
3.597951e-08
</td>
<td style="text-align:right;">
1.307107e-03
</td>
<td style="text-align:right;">
1.043868e-01
</td>
<td style="text-align:right;">
3.666727e-05
</td>
</tr>
<tr>
<td style="text-align:right;">
CDKN1B
</td>
<td style="text-align:right;">
ENSP00000228872.4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
65.665922
</td>
<td style="text-align:right;">
65.665922
</td>
<td style="text-align:right;">
1.969067e-01
</td>
<td style="text-align:right;">
8.077981e-08
</td>
<td style="text-align:right;">
1.240699e-07
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
1.227931e-04
</td>
<td style="text-align:right;">
1.217586e-04
</td>
</tr>
<tr>
<td style="text-align:right;">
RB1
</td>
<td style="text-align:right;">
ENSP00000267163.4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9879341
</td>
<td style="text-align:right;">
13.983016
</td>
<td style="text-align:right;">
13.983016
</td>
<td style="text-align:right;">
9.830044e-01
</td>
<td style="text-align:right;">
8.341608e-08
</td>
<td style="text-align:right;">
1.435185e-07
</td>
<td style="text-align:right;">
9.971783e-01
</td>
<td style="text-align:right;">
1.227931e-04
</td>
<td style="text-align:right;">
1.347054e-04
</td>
</tr>
<tr>
<td style="text-align:right;">
GATA3
</td>
<td style="text-align:right;">
ENSP00000341619.3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.9860517
</td>
<td style="text-align:right;">
40.720361
</td>
<td style="text-align:right;">
40.720361
</td>
<td style="text-align:right;">
6.110859e-05
</td>
<td style="text-align:right;">
7.678741e-06
</td>
<td style="text-align:right;">
1.474301e-07
</td>
<td style="text-align:right;">
6.282123e-02
</td>
<td style="text-align:right;">
8.138544e-03
</td>
<td style="text-align:right;">
1.347054e-04
</td>
</tr>
<tr>
<td style="text-align:right;">
CASP8
</td>
<td style="text-align:right;">
ENSP00000325722.7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7.5730275
</td>
<td style="text-align:right;">
20.864149
</td>
<td style="text-align:right;">
20.864149
</td>
<td style="text-align:right;">
2.911475e-05
</td>
<td style="text-align:right;">
1.249680e-04
</td>
<td style="text-align:right;">
1.283021e-06
</td>
<td style="text-align:right;">
3.492879e-02
</td>
<td style="text-align:right;">
1.034774e-01
</td>
<td style="text-align:right;">
1.096652e-03
</td>
</tr>
<tr>
<td style="text-align:right;">
NF1
</td>
<td style="text-align:right;">
ENSP00000348498.3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.2208160
</td>
<td style="text-align:right;">
9.250387
</td>
<td style="text-align:right;">
9.250387
</td>
<td style="text-align:right;">
6.437188e-01
</td>
<td style="text-align:right;">
1.275796e-06
</td>
<td style="text-align:right;">
2.708370e-06
</td>
<td style="text-align:right;">
9.188924e-01
</td>
<td style="text-align:right;">
1.609751e-03
</td>
<td style="text-align:right;">
2.110697e-03
</td>
</tr>
<tr>
<td style="text-align:right;">
NLRP2
</td>
<td style="text-align:right;">
ENSP00000409370.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.3485209
</td>
<td style="text-align:right;">
26.812675
</td>
<td style="text-align:right;">
26.812675
</td>
<td style="text-align:right;">
1.594534e-01
</td>
<td style="text-align:right;">
1.552340e-06
</td>
<td style="text-align:right;">
9.504172e-06
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
1.713848e-03
</td>
<td style="text-align:right;">
6.627159e-03
</td>
</tr>
<tr>
<td style="text-align:right;">
ERBB2
</td>
<td style="text-align:right;">
ENSP00000463714.1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.7813778
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
4.349957e-06
</td>
<td style="text-align:right;">
4.252854e-01
</td>
<td style="text-align:right;">
1.029753e-05
</td>
<td style="text-align:right;">
5.763041e-03
</td>
<td style="text-align:right;">
8.421570e-01
</td>
<td style="text-align:right;">
6.996247e-03
</td>
</tr>
<tr>
<td style="text-align:right;">
UQCR10
</td>
<td style="text-align:right;">
ENSP00000384962.3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.7941057
</td>
<td style="text-align:right;">
318.441902
</td>
<td style="text-align:right;">
318.441902
</td>
<td style="text-align:right;">
2.305730e-01
</td>
<td style="text-align:right;">
1.828142e-05
</td>
<td style="text-align:right;">
6.311122e-05
</td>
<td style="text-align:right;">
7.910200e-01
</td>
<td style="text-align:right;">
1.730010e-02
</td>
<td style="text-align:right;">
3.888972e-02
</td>
</tr>
</tbody>
</table>
<p>See dNdScv’s documentation if you’re interested in interpretation of
the dNdScv output.</p>
<p>Side note: If we had multiple tissue types in the analysis, we could
call gene_mutation_rates() multiple times using the <code>samples</code>
argument to specify sample groups, with appropriate covariates for each
tissue type. Similar functionality is available in
<code><a href="../reference/trinuc_mutation_rates.html">trinuc_mutation_rates()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="selection-inference">Selection inference<a class="anchor" aria-label="anchor" href="#selection-inference"></a>
</h2>
<p>The combination of cohort-level gene mutation rates and sample-level
relative rates of trinucleotide-context-specific substitution allow us
to estimate the rate at which any somatic substitution occurs in any
patient’s tumor sample. To be clear, by “rates,” we don’t mean the
frequency of mutations in our somatic variant calls (which we already
know anyway). These rates represent how often the mutations can be
expected to occur in individual cells. (More specifically, we assume
that mutation events in each specific sample and site follow a Poisson
distribution, and these rates are the Poisson rates.) It’s not typically
necessary to look at these rates, but just to show that we can:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's take the top 3 variants by MAF prevalence. These happen to all be in PIK3CA.</span></span>
<span><span class="va">variants_to_check</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">maf_prevalence</span><span class="op">)</span>, <span class="va">variant_id</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># A few random samples</span></span>
<span><span class="va">samples_to_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCGA-A2-A3Y0"</span>, <span class="st">"TCGA-XX-A89A"</span>, <span class="st">"P-0000224"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/baseline_mutation_rates.html">baseline_mutation_rates</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, variant_ids <span class="op">=</span> <span class="va">variants_to_check</span>, samples <span class="op">=</span> <span class="va">samples_to_check</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Unique_Patient_Identifier PIK3CA_H1047R_ENSP00000263967.3</span></span>
<span><span class="co">## 1:              TCGA-A2-A3Y0                    8.421009e-07</span></span>
<span><span class="co">## 2:              TCGA-XX-A89A                    8.045869e-08</span></span>
<span><span class="co">## 3:                 P-0000224                    7.888865e-07</span></span>
<span><span class="co">##    PIK3CA_E545K_ENSP00000263967.3 PIK3CA_E542K_ENSP00000263967.3</span></span>
<span><span class="co">## 1:                   1.773358e-06                   1.773358e-06</span></span>
<span><span class="co">## 2:                   1.211613e-05                   1.211613e-05</span></span>
<span><span class="co">## 3:                   8.932666e-06                   8.932666e-06</span></span></code></pre>
<p>Interestingly, PIK3CA H1047R, the most prevalent variant in our MAF
data (246/1875 samples), is estimated to have a substantially lower rate
of occurrence than E545K and E542K in these particular samples.</p>
<div class="section level3">
<h3 id="default-model">Default model<a class="anchor" aria-label="anchor" href="#default-model"></a>
</h3>
<p>We can use our estimated rates and the MAF variant data to infer
scaled selection coefficients (aka cancer effects, or selection
intensity) under a model of selection. These cancer effects are directly
proportional to the proliferative advantage provided by each variant.
First, let’s calculate selection under the package’s default model of
selection with ces_variant():</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Including an optional run_name</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ces_variant.html">ces_variant</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, run_name <span class="op">=</span> <span class="st">"recurrents"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the most selected variants. The following should be
fairly adaptable for a variety of data sets.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract selection results from CESAnalysis and take top variants for visualization</span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">selection</span><span class="op">$</span><span class="va">recurrents</span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="va">top</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">selection_intensity</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="co"># take top 20 by SI</span></span>
<span><span class="va">top</span> <span class="op">&lt;-</span> <span class="va">top</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">selection_intensity</span><span class="op">)</span><span class="op">]</span> <span class="co"># will plot lowest to highest (left to right)</span></span>
<span></span>
<span><span class="co"># Make variant names pretty for use in plot labels</span></span>
<span><span class="va">top</span><span class="op">[</span>, <span class="va">display_name</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">"\n"</span>, <span class="va">variant_name</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">top</span><span class="op">[</span>, <span class="va">display_levels</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">display_name</span>, levels <span class="op">=</span> <span class="va">display_name</span>, ordered <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">plot_title</span> <span class="op">&lt;-</span> <span class="st">"Top cancer effects in breast carcinoma (CES tutorial data)"</span></span>
<span><span class="va">n.dodge</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># can reduce to 1 if labels happen to still fit (e.g., if plotting fewer variants)</span></span>
<span></span>
<span><span class="co"># May need to play with breaks for colorbar legibility</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">top</span><span class="op">$</span><span class="va">included_with_variant</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">.75</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">top</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">display_levels</span>, y <span class="op">=</span> <span class="va">selection_intensity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_low_95</span>, ymax <span class="op">=</span> <span class="va">ci_high_95</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">.2</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">included_with_variant</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>n.dodge <span class="op">=</span> <span class="va">n.dodge</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"variant prevalence"</span>, guide <span class="op">=</span> <span class="st">"colorbar"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>,</span>
<span>    option <span class="op">=</span> <span class="st">"plasma"</span>, breaks <span class="op">=</span> <span class="va">breaks</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"cancer effect"</span> <span class="op">~</span> <span class="fu">scriptstyle</span><span class="op">(</span><span class="op">~</span> <span class="op">~</span> <span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="va">plot_title</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>ticks <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"Verdana"</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="cancereffectsizeR_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p><em>PIK3CA</em> and <em>ESR1</em> variants take many of the top
spots. The deconvolution of mutation rate from selection has revealed
that some relatively low-prevalence variants have high effects.
Interestingly, according to dNdScv, mutation in <em>ESR1</em> at the
gene level was not significantly greater than neutral in the TCGA cohort
of primary tumors. The incorporation of metastatic TGS data and
cancereffectsizeR’s assessment of selection at variant-level resolution
confirm <em>ESR1</em>’s importance.</p>
</div>
<div class="section level3">
<h3 id="more-options">More options<a class="anchor" aria-label="anchor" href="#more-options"></a>
</h3>
<p>By default, all recurrent variants (variants that appear at least
twice in MAF data) are included in a <code><a href="../reference/ces_variant.html">ces_variant()</a></code> run. As
demonstrated, the <code>variants</code> argument can be used to specify
which variants to test. Variants with prevalences of 1 or even 0
(perhaps helpful to establish an effect ceiling) can be included:
<code>variants = cesa$variants</code> will include all annotated
mutations in the analysis. Note that most single-hit variants will have
over-estimated effects because most are probably neutral passengers, and
the occurrence of any non-selected variant is inherently improbable.</p>
<p>For each variant site, only samples with coverage at the site will
inform selection inference. As also shown above, the
<code>samples</code> argument further limits the inference process to a
subset of eligible samples. This could be helpful to assess and compare
selection in various groups (e.g., smoking vs. non-smoking).</p>
<p>Besides the default model, <code><a href="../reference/ces_variant.html">ces_variant()</a></code> supports
user-supplied models of selection; see documentation for details. We
hope that some enterprising users will come up with new models, and we
are happy to discuss ideas and help work out any kinks.</p>
<p>The <code>CompoundVariantSet</code> feature, described in the next
section, may sometimes provide improved resolution of somatic selection
by batching related variants together.</p>
</div>
</div>
<div class="section level2">
<h2 id="epistatic-cancer-effects">Epistatic cancer effects<a class="anchor" aria-label="anchor" href="#epistatic-cancer-effects"></a>
</h2>
<p>In the default model, a variant is assumed to have a single cancer
effect across all samples. In reality, we expect a variant’s selection
to be influenced by a complex combination of factors including a
sample’s mutational background (from substitutions to structural
variants), the epigenetic state of the tumor, and various environmental
factors. The <code><a href="../reference/ces_epistasis.html">ces_epistasis()</a></code> function allows us to assess
selection for any pair of variants under a model of pairwise epistasis,
in which the selection intensity for each variant is allowed to very
depending on the state of the other site.</p>
<div class="section level3">
<h3 id="variant-level-epistasis">Variant-level epistasis<a class="anchor" aria-label="anchor" href="#variant-level-epistasis"></a>
</h3>
<p>Let’s try two prevalent BRCA mutations, PIK3CA E545K (n=159) and AKT1
E17K (n=82). Let’s also test E545K with a nearby PIK3CA variant, E542K
(n=93).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start by pulling full variant IDs (with protein identifier) from variants table</span></span>
<span><span class="va">group1</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PIK3CA_E545K"</span>, <span class="st">"AKT1_E17K"</span><span class="op">)</span>, <span class="va">variant_id</span>, on <span class="op">=</span> <span class="st">"variant_name"</span><span class="op">]</span></span>
<span><span class="va">group2</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PIK3CA_E545K"</span>, <span class="st">"PIK3CA_E542K"</span><span class="op">)</span>, <span class="va">variant_id</span>, on <span class="op">=</span> <span class="st">"variant_name"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ces_epistasis.html">ces_epistasis</a></span><span class="op">(</span></span>
<span>  cesa <span class="op">=</span> <span class="va">cesa</span>, variants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">group1</span>, <span class="va">group2</span><span class="op">)</span>,</span>
<span>  conf <span class="op">=</span> <span class="fl">.95</span>, run_name <span class="op">=</span> <span class="st">"variant_epistasis_example"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cesa</span><span class="op">$</span><span class="va">epistasis</span><span class="op">$</span><span class="va">variant_epistasis_example</span></span></code></pre></div>
<pre><code><span><span class="co">##                          variant1                       variant2   ces_v1</span></span>
<span><span class="co">## 1: PIK3CA_E545K_ENSP00000263967.3    AKT1_E17K_ENSP00000270202.4 11130.70</span></span>
<span><span class="co">## 2: PIK3CA_E545K_ENSP00000263967.3 PIK3CA_E542K_ENSP00000263967.3 11189.57</span></span>
<span><span class="co">##       ces_v2 ces_v1_after_v2 ces_v2_after_v1 joint_cov_samples_just_v1</span></span>
<span><span class="co">## 1: 20326.260           0.001        4951.200                       159</span></span>
<span><span class="co">## 2:  6503.937           0.001           0.001                       160</span></span>
<span><span class="co">##    joint_cov_samples_just_v2 joint_cov_samples_with_both</span></span>
<span><span class="co">## 1:                        80                           1</span></span>
<span><span class="co">## 2:                        93                           0</span></span>
<span><span class="co">##    joint_cov_samples_with_neither ci_low_95_ces_v1 ci_high_95_ces_v1</span></span>
<span><span class="co">## 1:                           1614         9492.836          12947.23</span></span>
<span><span class="co">## 2:                           1601         9542.933          13015.87</span></span>
<span><span class="co">##    ci_low_95_ces_v2 ci_high_95_ces_v2 ci_low_95_ces_v1_after_v2</span></span>
<span><span class="co">## 1:        16190.360         25113.390                        NA</span></span>
<span><span class="co">## 2:         5269.582          7917.667                        NA</span></span>
<span><span class="co">##    ci_high_95_ces_v1_after_v2 ci_low_95_ces_v2_after_v1</span></span>
<span><span class="co">## 1:                   8977.837                  282.2305</span></span>
<span><span class="co">## 2:                   4279.271                        NA</span></span>
<span><span class="co">##    ci_high_95_ces_v2_after_v1</span></span>
<span><span class="co">## 1:                  21877.772</span></span>
<span><span class="co">## 2:                   2431.834</span></span></code></pre>
<p>Confidence intervals tend to be wide in epistatic analyses. Even with
the most prevalent somatic variants, both co-occurrence and mutual
exclusivity can often be explained by chance. The output for PIK3CA
E545K and E542K confirms the negative epistatic relationship that we
would have expected given their mutual exclusivity in our data (and our
knowledge of their biological effects). For E545K and AKT1 E17K, we see
reduced selection for both after the acquisition of the other driver,
but the confidence intervals leave open the possibility that selection
for E545K is unaffected by AKT1 E17K status. (Additionally, the NA’s on
some of the lower bounds indicate that they fall below the lower limit
of the optimization algorithm.)</p>
</div>
<div class="section level3">
<h3 id="epistasis-and-compoundvariantsets">Epistasis and CompoundVariantSets<a class="anchor" aria-label="anchor" href="#epistasis-and-compoundvariantsets"></a>
</h3>
<p>We can probe this PIK3CA/AKT1 relationship further if we assume that
all prevalent PIK3CA mutations share the same epistatic relationship
with AKT1 E17K. The <code><a href="../reference/define_compound_variants.html">define_compound_variants()</a></code> feature lets
us combine arbitrary variants into “compound variants” that are treated
as if they were single variants by cancereffectsizeR’s selection
inference functions. (In brief, the mutation rate of the compound
variant is equal to the sum of rates of constituent variants, and any
sample with one or more of the constituent variants “has the compound
variant.”) Below, we define a CompoundVariantSet with two compound
variants: All <em>PIK3CA</em> variants with MAF prevalence &gt; 1, and
AKT E17K. We then pass the CompoundVariantSet to ces_epistasis(), which
will test all pairs of compound variants (here, just the one pair).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect all the variants that we want in the CompoundVariantSet into a table</span></span>
<span><span class="va">top_PIK3CA</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="va">gene</span> <span class="op">==</span> <span class="st">"PIK3CA"</span> <span class="op">&amp;</span> <span class="va">maf_prevalence</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">top_akt1</span> <span class="op">&lt;-</span> <span class="va">cesa</span><span class="op">$</span><span class="va">variants</span><span class="op">[</span><span class="va">variant_name</span> <span class="op">==</span> <span class="st">"AKT1_E17K"</span><span class="op">]</span></span>
<span><span class="va">for_compound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">top_PIK3CA</span>, <span class="va">top_akt1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># see define_compound_variants() documentation for details on arguments</span></span>
<span><span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_compound_variants.html">define_compound_variants</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, variant_table <span class="op">=</span> <span class="va">for_compound</span>, by <span class="op">=</span> <span class="st">"gene"</span>, merge_distance <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ces_epistasis.html">ces_epistasis</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, variants <span class="op">=</span> <span class="va">comp</span>, run_name <span class="op">=</span> <span class="st">"AKT1_E17K_vs_PIK3CA"</span><span class="op">)</span></span>
<span><span class="va">cesa</span><span class="op">$</span><span class="va">epistasis</span><span class="op">$</span><span class="va">AKT1_E17K_vs_PIK3CA</span></span></code></pre></div>
<pre><code><span><span class="co">##    variant1 variant2   ces_v1   ces_v2 ces_v1_after_v2 ces_v2_after_v1</span></span>
<span><span class="co">## 1: PIK3CA.1   AKT1.1 3810.191 24607.97        773.9648           0.001</span></span>
<span><span class="co">##    joint_cov_samples_just_v1 joint_cov_samples_just_v2</span></span>
<span><span class="co">## 1:                       642                        77</span></span>
<span><span class="co">##    joint_cov_samples_with_both joint_cov_samples_with_neither ci_low_95_ces_v1</span></span>
<span><span class="co">## 1:                           4                           1131         3520.196</span></span>
<span><span class="co">##    ci_high_95_ces_v1 ci_low_95_ces_v2 ci_high_95_ces_v2</span></span>
<span><span class="co">## 1:          4116.012         19625.39          30372.21</span></span>
<span><span class="co">##    ci_low_95_ces_v1_after_v2 ci_high_95_ces_v1_after_v2</span></span>
<span><span class="co">## 1:                  239.0299                   1815.866</span></span>
<span><span class="co">##    ci_low_95_ces_v2_after_v1 ci_high_95_ces_v2_after_v1</span></span>
<span><span class="co">## 1:                        NA                   6207.221</span></span></code></pre>
<p>Note that the effect sizes are smaller for PIK3CA here, since we
mixed in lots of lower-effect PIK3CA variants. While four samples have
both AKT1 E17K and one of the PIK3CA variants, this result strengthens
the case for AKT1 mutation reducing selection for PIK3CA mutation.</p>
</div>
<div class="section level3">
<h3 id="gene-level-epistasis">Gene-level epistasis<a class="anchor" aria-label="anchor" href="#gene-level-epistasis"></a>
</h3>
<p>The convenience function <code><a href="../reference/ces_gene_epistasis.html">ces_gene_epistasis()</a></code> provides a
simpler way to apply the model of <code><a href="../reference/ces_epistasis.html">ces_epistasis()</a></code> at the
gene level. The <code>variants</code> argument provides three options
for which variants from each gene to include in the inference:
“recurrent” uses all recurrent variants; “nonsilent” uses nonsynonymous
coding variants and any variants in essential splice sites; or,
alternatively, supply a custom table of variants.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AKT1"</span>, <span class="st">"PIK3CA"</span>, <span class="st">"TP53"</span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ces_gene_epistasis.html">ces_gene_epistasis</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, genes <span class="op">=</span> <span class="va">genes</span>, variants <span class="op">=</span> <span class="st">"nonsilent"</span>, run_name <span class="op">=</span> <span class="st">"gene_epistasis_example"</span><span class="op">)</span></span>
<span><span class="va">cesa</span><span class="op">$</span><span class="va">epistasis</span><span class="op">$</span><span class="va">gene_epistasis_example</span></span></code></pre></div>
<pre><code><span><span class="co">##    gene_1 gene_2   ces_g1   ces_g2 ces_g1_after_g2 ces_g2_after_g1</span></span>
<span><span class="co">## 1:   AKT1 PIK3CA 3581.699 2299.752           0.001        634.1875</span></span>
<span><span class="co">## 2:   AKT1   TP53 2624.452 1487.174        4190.559          0.0010</span></span>
<span><span class="co">## 3: PIK3CA   TP53 2126.708 1826.338        2988.684          0.0010</span></span>
<span><span class="co">##    joint_cov_samples_just_g1_mut joint_cov_samples_just_g2_mut</span></span>
<span><span class="co">## 1:                            82                           665</span></span>
<span><span class="co">## 2:                            73                           399</span></span>
<span><span class="co">## 3:                           559                           302</span></span>
<span><span class="co">##    joint_cov_samples_both_mut joint_cov_samples_no_mut ci_low_95_ces_g1</span></span>
<span><span class="co">## 1:                          6                     1101         2883.614</span></span>
<span><span class="co">## 2:                         15                     1367         2067.282</span></span>
<span><span class="co">## 3:                        112                      881         1953.153</span></span>
<span><span class="co">##    ci_high_95_ces_g1 ci_low_95_ces_g2 ci_high_95_ces_g2</span></span>
<span><span class="co">## 1:          4384.660         2127.634          2481.117</span></span>
<span><span class="co">## 2:          3273.888         1348.069          1635.585</span></span>
<span><span class="co">## 3:          2310.532         1654.519          2009.857</span></span>
<span><span class="co">##    ci_low_95_ces_g1_after_g2 ci_high_95_ces_g1_after_g2</span></span>
<span><span class="co">## 1:                        NA                   860.7655</span></span>
<span><span class="co">## 2:                  2404.988                  6708.6073</span></span>
<span><span class="co">## 3:                  2446.141                  3615.5202</span></span>
<span><span class="co">##    ci_low_95_ces_g2_after_g1 ci_high_95_ces_g2_after_g1</span></span>
<span><span class="co">## 1:                  250.5081                  1299.1061</span></span>
<span><span class="co">## 2:                        NA                  1161.4586</span></span>
<span><span class="co">## 3:                        NA                   309.2049</span></span></code></pre>
<p>Mutational selection in the two oncogenes appears to be maintained
after mutation in TP53. In contrast, loss of TP53 is less selected after
mutations in AKT1/PIK3CA; one explanation is that cell populations in
which these powerful drivers have fixed must have already subverted
tumor suppression mechanisms, making TP53 mutations superfluous. The two
oncogenes also appear to show some mutual exclusivity, in that selection
for each is reduced after mutation in the other.</p>
</div>
</div>
<div class="section level2">
<h2 id="save-your-work">Save your work<a class="anchor" aria-label="anchor" href="#save-your-work"></a>
</h2>
<p>Whether you’ve made it all the way through this tutorial–or simply
want to take a break–you can save a commemorative (and space-efficient)
copy of your CESAnalysis using <code><a href="../reference/save_cesa.html">save_cesa()</a></code>. You can reload
the analysis anytime with <code><a href="../reference/load_cesa.html">load_cesa()</a></code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_cesa.html">save_cesa</a></span><span class="op">(</span>cesa <span class="op">=</span> <span class="va">cesa</span>, <span class="st">"cancerffectsizeR_tutorial_analysis.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In some future R session...</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://townsend-lab-yale.github.io/cancereffectsizeR">cancereffectsizeR</a></span><span class="op">)</span></span>
<span><span class="va">cesa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_cesa.html">load_cesa</a></span><span class="op">(</span><span class="st">"cancerffectsizeR_tutorial_analysis.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent L. Cannataro, Jeff Mandell.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
